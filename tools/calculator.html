<!DOCTYPE html>
<html>
<head>
  <title>简单计算器</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f5f5f5;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .main-wrapper {
      display: flex;
      gap: 20px;
      max-width: 1200px;
      width: 100%;
    }
    
    .container {
      flex: 1;
      max-width: 800px;
      padding: 30px;
      text-align: center;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar {
      width: 300px;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }
    
    .sidebar h3 {
      margin-top: 0;
      color: #007bff;
      text-align: center;
    }
    
    .sidebar .input-group {
      margin: 15px 0;
    }
    
    .sidebar input {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 2px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    
    .sidebar button {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    
    .sidebar button:hover {
      background-color: #218838;
    }
    
    .sidebar #quickResults {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #28a745;
      font-size: 14px;
    }
    
    .sidebar #quickResults h4 {
      margin-top: 0;
      color: #28a745;
      font-size: 16px;
    }
    
    .sidebar #quickResults p {
      margin: 8px 0;
      line-height: 1.4;
    }
    
    .sidebar-divider {
      height: 1px;
      background-color: #dee2e6;
      margin: 20px 0;
    }
    
    .input-group {
      margin: 15px 0;
      text-align: left;
    }
    
    .input-row {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .input-item {
      flex: 1;
      min-width: 150px;
    }

    .item-container {
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .item-header h4 {
      margin: 0;
      color: #495057;
    }
    
    .remove-item-btn {
      padding: 5px 10px;
      font-size: 14px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .remove-item-btn:hover {
      background-color: #c82333;
    }

    #add-item-btn {
      margin: 10px 0 20px 0;
    }
    
    .input-group label,
    .input-item label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
      font-size: 14px;
    }
    
    .input-group input,
    .input-item input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
    }
    
    #input {
      width: 300px;
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
    
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    button:hover {
      background-color: #0056b3;
    }
    
    #result {
      font-weight: bold;
      color: #007bff;
      font-size: 18px;
    }
    
    #boxSuggestions {
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #007bff;
    }
    
    #boxSuggestions h3 {
      margin-top: 0;
      color: #007bff;
    }
    
    #boxSuggestions p {
      margin: 10px 0;
    }
    
    #shippingSection {
      margin: 20px 0;
      padding: 15px;
      background-color: #e8f4f8;
      border-radius: 5px;
      border-left: 4px solid #17a2b8;
    }
    
    #shippingResults {
      margin-top: 15px;
      padding: 10px;
      background-color: #d4edda;
      border-radius: 5px;
      border-left: 4px solid #28a745;
    }
    
    #shippingResults h4 {
      margin-top: 0;
      color: #28a745;
    }

    #domesticShippingSection {
      margin: 20px 0;
      padding: 15px;
      background-color: #fffbe6;
      border-radius: 5px;
      border-left: 4px solid #ffc107;
    }

    #domesticShippingResults {
       margin-top: 15px;
      padding: 10px;
      background-color: #e9f7ef;
      border-radius: 5px;
      border-left: 4px solid #28a745;
    }
    
    #history {
      text-align: left;
      max-width: 500px;
      margin: 0 auto;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #fafafa;
    }
    
    #history li {
      padding: 10px;
      border-bottom: 1px solid #eee;
      position: relative;
      transition: background-color 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #history li:hover {
      background-color: #f0f8ff;
    }
    
    #history li:last-child {
      border-bottom: none;
    }
    
    .history-item {
      flex: 1;
      font-size: 14px;
    }
    
    .history-time {
      font-size: 12px;
      color: #666;
      margin-left: 10px;
    }
    
    .history-actions {
      display: flex;
      gap: 5px;
    }
    
    .history-btn {
      padding: 2px 6px;
      font-size: 12px;
      border: 1px solid #ccc;
      background-color: white;
      border-radius: 3px;
      cursor: pointer;
      color: #666;
    }
    
    .history-btn:hover {
      background-color: #e9ecef;
    }
    
    .clear-history-btn {
      margin-bottom: 10px;
      padding: 8px 15px;
      font-size: 14px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .clear-history-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <div class="container">
      <h1>体积计算器</h1>
      <div style="text-align: center; margin: 20px 0;">
        <img src="../assets/images/shu.gif" alt="装饰图片" style="max-width: 150px; height: auto; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      </div>
    <div id="items-wrapper">
      <div class="item-container">
        <div class="item-header">
          <h4>货物 1</h4>
        </div>
        <div class="input-row">
          <div class="input-item">
            <label>长度 (cm):</label>
            <input type="number" class="length" placeholder="输入长度" step="0.01">
          </div>
          <div class="input-item">
            <label>宽度 (cm):</label>
            <input type="number" class="width" placeholder="输入宽度" step="0.01">
          </div>
          <div class="input-item">
            <label>高度 (cm):</label>
            <input type="number" class="height" placeholder="输入高度" step="0.01">
          </div>
          <div class="input-item">
            <label>单位体积货物数量:</label>
            <input type="number" class="unitQuantity" placeholder="输入单位体积货物数量" step="1">
          </div>
          <div class="input-item">
            <label>实际货物数量:</label>
            <input type="number" class="actualQuantity" placeholder="输入实际货物数量" step="1">
          </div>
        </div>
      </div>
    </div>
    <button id="add-item-btn" onclick="addItem()">添加其他货物</button>
    <button onclick="calculateVolume()">计算总体积</button>
    <p><b>合计实际体积：<span id="result"></span> m³</b></p>
    <div id="boxSuggestions"></div>
    
    <div id="shippingSection" style="display: none;">
      <div class="input-group">
        <label for="internationalDestination">国际目的地:</label>
        <select id="internationalDestination" style="padding: 10px; font-size: 16px; border-radius: 5px; margin-right: 10px;">
          <option value="美国">美国</option>
          <option value="欧洲">欧洲</option>
          <option value="其他">其他</option>
        </select>
        <label>每重量单价 (国际):</label>
        <input type="number" id="pricePerWeight" placeholder="输入国际运费每重量单价" step="0.01">
        <button onclick="calculateShipping()" style="margin-left: 10px;">计算国际运费</button>
      </div>
      <div id="shippingResults"></div>
    </div>

    <div id="domesticShippingSection" style="display: none;">
      <div class="input-group">
        <label for="destination">目的地:</label>
        <select id="destination" style="padding: 10px; font-size: 16px; border-radius: 5px;"></select>
        <button onclick="calculateDomesticShipping()" style="margin-left: 10px;">计算国内运费</button>
      </div>
      <div id="domesticShippingResults"></div>
    </div>

    <h2>计算历史</h2>
    <div id="historyContainer">
      <button class="clear-history-btn" onclick="clearHistory()" style="display: none;" id="clearBtn">清空历史</button>
      <ul id="history"></ul>
      <p id="noHistory" style="text-align: center; color: #666; font-style: italic;">暂无计算历史</p>
    </div>
  </div>
  
  <!-- 侧边栏 - 快速箱子推荐 -->
  <div class="sidebar">
    <h3>快速箱子推荐</h3>
    
    <div class="input-group">
      <label>方式一：直接输入体积 (m³)</label>
      <input type="number" id="quickVolume" placeholder="输入体积" step="0.000001">
      <button onclick="quickRecommendByVolume()">推荐箱子</button>
    </div>
    
    <div class="sidebar-divider"></div>
    
    <div class="input-group">
      <label>方式二：输入长宽高 (cm)</label>
      <input type="number" id="quickLength" placeholder="长度" step="0.01">
      <input type="number" id="quickWidth" placeholder="宽度" step="0.01">
      <input type="number" id="quickHeight" placeholder="高度" step="0.01">
      <button onclick="quickRecommendByDimensions()">推荐箱子</button>
    </div>
    
    <div id="quickResults" style="display: none;">
      <h4>推荐结果</h4>
      <div id="quickResultsContent"></div>
    </div>
  </div>
  
  </div>

  <script>
    const history = [];
    let currentSuitableBoxes = []; // 存储当前推荐的箱子
    
    const domesticShippingRates = {
        "天津": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.4},
            "百世":    {"最低": 20,  "0.4下/10000": 0.8, "0.4-4.99/8000": 0.8},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.0}
        },
        "北京": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.4},
            "百世":    {"最低": 30,  "0.4下/10000": 1.3, "0.4-4.99/8000": 1.3},
            "顺心捷达": {"最低": 33,  "0.55/10000": 1.4}
        },
        "河北": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.4},
            "百世":    {"最低": 30,  "0.4下/10000": 1.1, "0.4-4.99/8000": 1.1},
            "顺心捷达": {"最低": 33,  "0.55/10000": 1.2}
        },
        "山东": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.4},
            "百世":    {"最低": 30,  "0.4下/10000": 1.1, "0.4-4.99/8000": 1.1},
            "顺心捷达": {"最低": 25,  "0.55/10000": 1.25}
        },
        "江浙沪": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 30,  "0.4下/10000": 1.3, "0.4-4.99/8000": 1.3},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.3}
        },
        "河南": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 30,  "0.4下/10000": 1.2, "0.4-4.99/8000": 1.2},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.2}
        },
        "安徽": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 30,  "0.4下/10000": 1.3, "0.4-4.99/8000": 1.3},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.2}
        },
        "广东": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.6, "0.4-4.99/8000": 1.6},
            "顺心捷达": {"最低": 35,  "0.55/10000": 1.6}
        },
        "湖南": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 2.0},
            "百世":    {"最低": 35,  "0.4下/10000": 1.5, "0.4-4.99/8000": 1.5},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.6}
        },
        "湖北": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.5, "0.4-4.99/8000": 1.5},
            "顺心捷达": {"最低": 35,  "0.55/10000": 1.3}
        },
        "山西": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 30,  "0.4下/10000": 1.3, "0.4-4.99/8000": 1.3},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.3}
        },
        "江西": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.6, "0.4-4.99/8000": 1.6},
            "顺心捷达": {"最低": 35,  "0.55/10000": 1.5}
        },
        "陕西": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.5, "0.4-4.99/8000": 1.5},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.5}
        },
        "辽宁": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 30,  "0.4下/10000": 1.5, "0.4-4.99/8000": 1.5},
            "顺心捷达": {"最低": 45,  "0.55/10000": 1.5}
        },
        "吉林": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.6, "0.4-4.99/8000": 1.6},
            "顺心捷达": {"最低": 35,  "0.55/10000": 1.7}
        },
        "黑龙江": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 1.8},
            "百世":    {"最低": 35,  "0.4下/10000": 1.6, "0.4-4.99/8000": 1.6},
            "顺心捷达": {"最低": 60,  "0.55/10000": 1.9}
        },
        "福建": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 2.2},
            "百世":    {"最低": 40,  "0.4下/10000": 1.7, "0.4-4.99/8000": 1.7},
            "顺心捷达": {"最低": 30,  "0.55/10000": 1.5}
        },
        "四川重庆": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 2.2},
            "百世":    {"最低": 40,  "0.4下/10000": 1.8, "0.4-4.99/8000": 1.8},
            "顺心捷达": {"最低": 40,  "0.55/10000": 1.6}
        },
        "内蒙一区": {
            "韵达":    {"3KG":  3.4, "5KG": 7.0, "5上": 2.2},
            "百世":    {"最低": 35,  "0.4下/10000": 1.7, "0.4-4.99/8000": 1.7},
            "顺心捷达": {"最低": 70,  "0.55/10000": 2.0}
        },
        "云南": {
            "韵达":    {"3KG":  3.7, "5KG": 9.0, "5上": 3.5},
            "百世":    {"最低": 45,  "0.4下/10000": 2.5, "0.4-4.99/8000": 2.5},
            "顺心捷达": {"最低": 45,  "0.55/10000": 2.5}
        },
        "贵州": {
            "韵达":    {"3KG":  3.7, "5KG": 9.0, "5上": 3.5},
            "百世":    {"最低": 45,  "0.4下/10000": 2.0, "0.4-4.99/8000": 2.0},
            "顺心捷达": {"最低": 75,  "0.55/10000": 3.0}
        },
        "广西": {
            "韵达":    {"3KG":  3.7, "5KG": 9.0, "5上": 3.5},
            "百世":    {"最低": 45,  "0.4下/10000": 2.5, "0.4-4.99/8000": 2.5},
            "顺心捷达": {"最低": 45,  "0.55/10000": 1.6}
        },
        "甘肃": {
            "韵达":    {"3KG":  3.7, "5KG": 9.0, "5上": 3.0},
            "百世":    {"最低": 50,  "0.4下/10000": 2.5, "0.4-4.99/8000": 2.5},
            "顺心捷达": {"最低": 70,  "0.55/10000": 3.5}
        },
        "宁夏": {
            "韵达":    {"3KG":  3.7, "5KG": 9.0, "5上": 3.0},
            "百世":    {"最低": 50,  "0.4下/10000": 2.0, "0.4-4.99/8000": 2.0},
            "顺心捷达": {"最低": 70,  "0.55/10000": 1.9}
        },
        "海南": {
            "韵达":    {"3KG":  5.5, "5KG": null, "5上": null},
            "百世":    {"最低": 50,  "0.4下/10000": 2.8, "0.4-4.99/8000": 2.8},
            "顺心捷达": {"最低": 60,  "0.55/10000": 3.0}
        },
        "青海": {
            "韵达":    {"3KG":  5.5, "5KG": null, "5上": null},
            "百世":    {"最低": 50,  "0.4下/10000": 3.0, "0.4-4.99/8000": 3.0},
            "顺心捷达": {"最低": 90,  "0.55/10000": 3.5}
        },
        "新疆": {
            "韵达":    {"3KG": 13.0, "5KG": null, "5上": null},
            "百世":    {"最低": 80,  "0.4下/10000": 5.0, "0.4-4.99/8000": 5.0},
            "顺心捷达": {"最低": 90,  "0.55/10000": 5.0}
        },
        "西藏": {
            "韵达":    {"3KG": 22.0, "5KG": null, "5上": null},
            "百世":    {"最低": 80,  "0.4下/10000": 6.0, "0.4-4.99/8000": 6.0},
            "顺心捷达": {"最低": 90,  "0.55/10000": 5.0}
        },
        "内蒙二区": {
            "韵达":    {"3KG":  5.5, "5KG": null, "5上": null},
            "百世":    {"最低": null,"0.4下/10000": null,"0.4-4.99/8000": null},
            "顺心捷达": {"最低": null,"0.55/10000": null}
        }
    };

    // 箱子数据 (长*宽*高，单位：cm)
    const boxes = [
      {size: "18*10*12", volume: 0.002160, dimensions: {l: 18, w: 10, h: 12}},
      {size: "19.5*10.5*13.5", volume: 0.002766, dimensions: {l: 19.5, w: 10.5, h: 13.5}},
      {size: "21*11*14", volume: 0.003234, dimensions: {l: 21, w: 11, h: 14}},
      {size: "23*13*8", volume: 0.002392, dimensions: {l: 23, w: 13, h: 8}},
      {size: "23*13*26", volume: 0.007774, dimensions: {l: 23, w: 13, h: 26}},
      {size: "26*15*9", volume: 0.003510, dimensions: {l: 26, w: 15, h: 9}},
      {size: "26*15*18", volume: 0.007020, dimensions: {l: 26, w: 15, h: 18}},
      {size: "29*17*19", volume: 0.009367, dimensions: {l: 29, w: 17, h: 19}},
      {size: "29*37*52", volume: 0.055796, dimensions: {l: 29, w: 37, h: 52}},
      {size: "30*21.5*5", volume: 0.003225, dimensions: {l: 30, w: 21.5, h: 5}},
      {size: "35*19*23", volume: 0.015295, dimensions: {l: 35, w: 19, h: 23}},
      {size: "37*37*47", volume: 0.064343, dimensions: {l: 37, w: 37, h: 47}},
      {size: "43*21*28", volume: 0.025284, dimensions: {l: 43, w: 21, h: 28}},
      {size: "47*36*41", volume: 0.069372, dimensions: {l: 47, w: 36, h: 41}},
      {size: "47*37*43", volume: 0.074761, dimensions: {l: 47, w: 37, h: 43}},
      {size: "49*27*27", volume: 0.035721, dimensions: {l: 49, w: 27, h: 27}},
      {size: "49*27*33", volume: 0.043659, dimensions: {l: 49, w: 27, h: 33}},
      {size: "50*50*50", volume: 0.125000, dimensions: {l: 50, w: 50, h: 50}},
      {size: "57*40*35", volume: 0.079800, dimensions: {l: 57, w: 40, h: 35}},
      {size: "60*40*30", volume: 0.072000, dimensions: {l: 60, w: 40, h: 30}},
      {size: "60*40*40", volume: 0.096000, dimensions: {l: 60, w: 40, h: 40}},
      {size: "70*50*50", volume: 0.175000, dimensions: {l: 70, w: 50, h: 50}},
      {size: "85*50*50", volume: 0.212500, dimensions: {l: 85, w: 50, h: 50}},
      {size: "90*30*30", volume: 0.081000, dimensions: {l: 90, w: 30, h: 30}},
      {size: "100*16*16", volume: 0.025600, dimensions: {l: 100, w: 16, h: 16}},
      {size: "100*50*50", volume: 0.250000, dimensions: {l: 100, w: 50, h: 50}},
      {size: "130*30*20", volume: 0.078000, dimensions: {l: 130, w: 30, h: 20}},
      {size: "130*40*60", volume: 0.312000, dimensions: {l: 130, w: 40, h: 60}},
      {size: "130*50*20", volume: 0.130000, dimensions: {l: 130, w: 50, h: 20}},
      {size: "130*50*50", volume: 0.325000, dimensions: {l: 130, w: 50, h: 50}},
      {size: "130*50*60", volume: 0.390000, dimensions: {l: 130, w: 50, h: 60}},
      {size: "130*50*80", volume: 0.520000, dimensions: {l: 130, w: 50, h: 80}},
      {size: "130*60*80", volume: 0.624000, dimensions: {l: 130, w: 60, h: 80}},
      {size: "140*60*16", volume: 0.134400, dimensions: {l: 140, w: 60, h: 16}}
    ];
    
    // 按体积排序
    boxes.sort((a, b) => a.volume - b.volume);

    let itemCount = 1;

    window.onload = function() {
      const destinationSelect = document.getElementById('destination');
      const destinations = Object.keys(domesticShippingRates);
      destinations.forEach(dest => {
        const option = document.createElement('option');
        option.value = dest;
        option.textContent = dest;
        destinationSelect.appendChild(option);
      });
    };

    function addItem() {
      itemCount++;
      const newItem = document.createElement('div');
      newItem.className = 'item-container';
      newItem.innerHTML = `
        <div class="item-header">
          <h4>货物 ${itemCount}</h4>
          <button class="remove-item-btn" onclick="removeItem(this)">删除此货物</button>
        </div>
        <div class="input-row">
          <div class="input-item">
            <label>长度 (cm):</label>
            <input type="number" class="length" placeholder="输入长度" step="0.01">
          </div>
          <div class="input-item">
            <label>宽度 (cm):</label>
            <input type="number" class="width" placeholder="输入宽度" step="0.01">
          </div>
          <div class="input-item">
            <label>高度 (cm):</label>
            <input type="number" class="height" placeholder="输入高度" step="0.01">
          </div>
          <div class="input-item">
            <label>单位体积货物数量:</label>
            <input type="number" class="unitQuantity" placeholder="输入单位体积货物数量" step="1">
          </div>
          <div class="input-item">
            <label>实际货物数量:</label>
            <input type="number" class="actualQuantity" placeholder="输入实际货物数量" step="1">
          </div>
        </div>
      `;
      document.getElementById('items-wrapper').appendChild(newItem);
    }

    function removeItem(button) {
      const itemContainer = button.closest('.item-container');
      itemContainer.remove();
      // Optional: re-number items
      const itemContainers = document.querySelectorAll('.item-container');
      itemCount = itemContainers.length;
      itemContainers.forEach((container, index) => {
        container.querySelector('h4').textContent = `货物 ${index + 1}`;
      });
    }

    function calculateVolume() {
      const itemContainers = document.querySelectorAll('.item-container');
      let totalActualVolume = 0;
      let allInputsValid = true;
      let historyData = [];

      itemContainers.forEach(container => {
        const length = parseFloat(container.querySelector(".length").value);
        const width = parseFloat(container.querySelector(".width").value);
        const height = parseFloat(container.querySelector(".height").value);
        const unitQuantity = parseFloat(container.querySelector(".unitQuantity").value);
        const actualQuantity = parseFloat(container.querySelector(".actualQuantity").value);

        if (isNaN(length) || isNaN(width) || isNaN(height) || isNaN(unitQuantity) || isNaN(actualQuantity)) {
          allInputsValid = false;
          return;
        }
        
        if (unitQuantity <= 0) {
          allInputsValid = false;
          return;
        }

        historyData.push({ length, width, height, unitQuantity, actualQuantity });
        
        const lengthInM = length / 100;
        const widthInM = width / 100;
        const heightInM = height / 100;
        
        const itemVolume = (lengthInM * widthInM * heightInM / unitQuantity) * actualQuantity;
        totalActualVolume += itemVolume;
      });

      if (!allInputsValid) {
        document.getElementById("result").textContent = "所有货物均需输入有效的数值";
        return;
      }
      
      const result = totalActualVolume.toFixed(7);
      document.getElementById("result").textContent = result;
      
      findSuitableBoxes(totalActualVolume);
      document.getElementById("shippingSection").style.display = "block";
      document.getElementById("domesticShippingSection").style.display = "block";
      document.getElementById("shippingResults").innerHTML = ""; 
      document.getElementById("domesticShippingResults").innerHTML = "";
      
      document.getElementById("result").scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      const timestamp = new Date().toLocaleString('zh-CN');
      const historyItem = { 
        calculation: `合计体积: ${result}m³ (${itemContainers.length}种货物)`, 
        time: timestamp,
        data: historyData[0] // For simplicity, reuse will only use the first item's data
      };
      history.unshift(historyItem);

      if (history.length > 20) {
        history.pop();
      }

      updateHistory();
    }
    
    function findSuitableBoxes(targetVolume) {
      const suggestionsDiv = document.getElementById("boxSuggestions");
      let html = "<h3>装箱方案推荐</h3>";
      currentSuitableBoxes = []; // 重置当前推荐的箱子

      if (targetVolume > 0.125) {
        // --- 方案一：分箱 ---
        html += `<h4>方案一：分箱方案</h4>`;
        const largeBoxVolume = 0.125;
        const largeBox = boxes.find(box => box.size === "50*50*50");
        const largeBoxCount = Math.floor(targetVolume / largeBoxVolume);
        const remainingVolume = targetVolume % largeBoxVolume;

        html += `<p>首先使用 ${largeBoxCount} 个大箱 (50*50*50cm, 0.125m³)。</p>`;
        if (remainingVolume > 0) {
            html += `<p>剩余体积: ${remainingVolume.toFixed(7)}m³，需要额外一个箱子来装。</p>`;
            const { closestLarger: remainderLarger, closestSmaller: remainderSmaller } = findClosestBoxes(remainingVolume);
            
            html += `<h5>剩余部分推荐箱子:</h5>`;
            if (remainderLarger) {
                currentSuitableBoxes.push({
                    type: 'split',
                    largeBox: largeBox,
                    largeBoxCount: largeBoxCount,
                    remainderBox: remainderLarger,
                    name: `分箱推荐 (较大): ${largeBoxCount}*50x50x50 + 1*${remainderLarger.size}`
                });
                html += `<p><b>推荐 (较大):</b> ${remainderLarger.size}cm (${remainderLarger.volume.toFixed(6)}m³)</p>`;
            }
            if (remainderSmaller) {
                 currentSuitableBoxes.push({
                    type: 'split',
                    largeBox: largeBox,
                    largeBoxCount: largeBoxCount,
                    remainderBox: remainderSmaller,
                    name: `分箱推荐 (较小): ${largeBoxCount}*50x50x50 + 1*${remainderSmaller.size}`
                });
                html += `<p><b>推荐 (较小):</b> ${remainderSmaller.size}cm (${remainderSmaller.volume.toFixed(6)}m³)</p>`;
            }
        } else {
            // 正好装满，没有剩余体积
            currentSuitableBoxes.push({
                type: 'split',
                largeBox: largeBox,
                largeBoxCount: largeBoxCount,
                remainderBox: null, // No remainder box
                name: `分箱推荐: ${largeBoxCount}*50x50x50`
            });
        }

        // --- 方案二：不分箱 ---
        html += `<hr style="margin: 20px 0;">`;
        html += `<h4>方案二：不分箱方案 (使用单个大箱)</h4>`;
        const { closestLarger, closestSmaller } = findClosestBoxes(targetVolume);
        
        if (closestLarger) {
            currentSuitableBoxes.push({ type: 'single', box: closestLarger, name: `不分箱推荐 (较大): ${closestLarger.size}` });
            html += `<p><b>推荐 (较大):</b> ${closestLarger.size}cm (${closestLarger.volume.toFixed(6)}m³)</p>`;
        }
        if (closestSmaller) {
            currentSuitableBoxes.push({ type: 'single', box: closestSmaller, name: `不分箱推荐 (较小): ${closestSmaller.size}` });
            html += `<p><b>推荐 (较小):</b> ${closestSmaller.size}cm (${closestSmaller.volume.toFixed(6)}m³)</p>`;
        }

      } else {
        // --- 单箱方案 (体积 <= 0.125) ---
        html += `<h4>方案：单个箱子</h4>`;
        const { closestLarger, closestSmaller } = findClosestBoxes(targetVolume);
        
        if (closestLarger) {
            currentSuitableBoxes.push({ type: 'single', box: closestLarger, name: `推荐 (较大): ${closestLarger.size}` });
            html += `<p><b>推荐1 (较大):</b> ${closestLarger.size}cm (${closestLarger.volume.toFixed(6)}m³)</p>`;
        }
        if (closestSmaller) {
            currentSuitableBoxes.push({ type: 'single', box: closestSmaller, name: `推荐 (较小): ${closestSmaller.size}` });
            html += `<p><b>推荐2 (较小):</b> ${closestSmaller.size}cm (${closestSmaller.volume.toFixed(6)}m³)</p>`;
        }
      }
      
      if (currentSuitableBoxes.length === 0) {
        html += "<p>未找到合适的箱子。</p>";
      }

      suggestionsDiv.innerHTML = html;
    }

    function findClosestBoxes(volume) {
        const largerBoxes = boxes.filter(box => box.volume > volume);
        const closestLarger = largerBoxes.length > 0 ? largerBoxes[0] : null;

        const smallerBoxes = boxes.filter(box => box.volume <= volume);
        const closestSmaller = smallerBoxes.length > 0 ? smallerBoxes[smallerBoxes.length - 1] : null;

        return { closestLarger, closestSmaller };
    }
    
    function calculateShipping() {
      const pricePerWeight = parseFloat(document.getElementById("pricePerWeight").value);
      const destination = document.getElementById("internationalDestination").value;

      if (isNaN(pricePerWeight) || pricePerWeight <= 0) {
        document.getElementById("shippingResults").innerHTML = "<p style='color: red;'>请输入有效的每重量单价</p>";
        return;
      }

      // 获取最低重量限制
      let minWeight = 0;
      switch (destination) {
        case "美国":
          minWeight = 12;
          break;
        case "欧洲":
          minWeight = 21;
          break;
        case "其他":
          minWeight = 0;
          break;
      }

      let html = `<h3>各方案运费详情 (目的地: ${destination})</h3>`;
      
      if (currentSuitableBoxes.length === 0) {
        html += "<p>没有推荐的装箱方案，无法计算运费。</p>";
        document.getElementById("shippingResults").innerHTML = html;
        return;
      }

      currentSuitableBoxes.forEach((plan) => {
        let totalCost = 0;
        let planHtml = `<div style="margin: 15px 0; padding: 15px; background-color: white; border-radius: 5px; border: 1px solid #dee2e6;">`;
        planHtml += `<h4 style="margin-top:0; color: #007bff;">${plan.name}</h4>`;

        if (plan.type === 'single') {
            const { cost, detailsHtml } = calculateBoxCost(plan.box, pricePerWeight, minWeight);
            totalCost = cost;
            planHtml += detailsHtml;
        } else if (plan.type === 'split') {
            // 大箱子成本
            const { cost: largeBoxCost, detailsHtml: largeBoxDetails } = calculateBoxCost(plan.largeBox, pricePerWeight, minWeight);
            const totalLargeBoxCost = largeBoxCost * plan.largeBoxCount;
            planHtml += `<h5>大箱部分 (x${plan.largeBoxCount})</h5>`;
            planHtml += largeBoxDetails;
            planHtml += `<p style="font-weight: bold;">大箱总运费: ${totalLargeBoxCost.toFixed(2)} (${plan.largeBoxCount} × ${largeBoxCost.toFixed(2)})</p>`;

            // 剩余部分箱子成本
            if (plan.remainderBox) {
                const { cost: remainderBoxCost, detailsHtml: remainderBoxDetails } = calculateBoxCost(plan.remainderBox, pricePerWeight, minWeight);
                planHtml += `<h5 style="margin-top: 15px;">剩余部分箱子</h5>`;
                planHtml += remainderBoxDetails;
                totalCost = totalLargeBoxCost + remainderBoxCost;
            } else {
                totalCost = totalLargeBoxCost;
            }
        }
        
        planHtml += `<p style="font-weight: bold; font-size: 18px; color: #28a745; margin-top: 10px;">此方案总运费: ${totalCost.toFixed(2)}</p>`;
        planHtml += `</div>`;
        html += planHtml;
      });

      document.getElementById("shippingResults").innerHTML = html;
      document.getElementById("shippingResults").scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function calculateDomesticShipping() {
        const destination = document.getElementById("destination").value;
        const rates = domesticShippingRates[destination];
        const resultsDiv = document.getElementById("domesticShippingResults");

        if (!rates) {
            resultsDiv.innerHTML = "<p style='color: red;'>请选择一个有效的目的地。</p>";
            return;
        }

        let html = `<h3>国内运费详情 (目的地: ${destination})</h3>`;

        if (currentSuitableBoxes.length === 0) {
            html += "<p>没有推荐的装箱方案，无法计算运费。</p>";
            resultsDiv.innerHTML = html;
            return;
        }

        currentSuitableBoxes.forEach(plan => {
            html += `<div style="margin: 15px 0; padding: 15px; background-color: white; border-radius: 5px; border: 1px solid #dee2e6;">`;
            html += `<h4 style="margin-top:0; color: #007bff;">${plan.name}</h4>`;

            // 1. Calculate total adjusted volume for the plan
            let totalAdjustedVolume = 0;
            if (plan.type === 'single') {
                totalAdjustedVolume = getAdjustedVolume(plan.box);
            } else if (plan.type === 'split') {
                totalAdjustedVolume += getAdjustedVolume(plan.largeBox) * plan.largeBoxCount;
                if (plan.remainderBox) {
                    totalAdjustedVolume += getAdjustedVolume(plan.remainderBox);
                }
            } else {
                // 处理没有类型字段的方案（向后兼容）
                if (plan.box) {
                    totalAdjustedVolume = getAdjustedVolume(plan.box);
                }
            }
            html += `<p><b>总外箱体积:</b> ${totalAdjustedVolume.toFixed(6)} m³</p><hr>`;

            // 2. Calculate cost for each company
            html += calculateCompanyCost("韵达", rates["韵达"], totalAdjustedVolume);
            html += calculateCompanyCost("百世", rates["百世"], totalAdjustedVolume);
            html += calculateCompanyCost("顺心捷达", rates["顺心捷达"], totalAdjustedVolume);

            html += `</div>`;
        });

        resultsDiv.innerHTML = html;
        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function getAdjustedVolume(box) {
        if (!box) return 0;
        const adjustedLength = (box.dimensions.l + 3) / 100;
        const adjustedWidth = (box.dimensions.w + 3) / 100;
        const adjustedHeight = (box.dimensions.h + 3) / 100;
        return adjustedLength * adjustedWidth * adjustedHeight;
    }

    function calculateCompanyCost(companyName, companyRates, volume) {
        let costHtml = `<h5 style="color: #17a2b8;">${companyName}</h5>`;
        if (!companyRates || Object.values(companyRates).every(val => val === null)) {
            return costHtml + "<p>此地区不支持</p>";
        }

        let weight = 0;
        let cost = 0;
        let calculationDetails = "";

        switch (companyName) {
            case "韵达":
                weight = volume / 0.01;
                calculationDetails = `<p>计算方式: 体积 / 0.01 (韵达抛比)</p>`;
                weight = Math.ceil(weight); // 向上取整
                calculationDetails += `<p>抛重: ${weight} kg (向上取整)</p>`;
                if (weight <= 3) {
                    cost = companyRates["3KG"];
                    calculationDetails += `<p>计算价格: ¥${cost} (3KG内一口价)</p>`;
                    calculationDetails += `<p>最终价格: ¥${cost}</p>`;
                } else if (weight <= 5 && companyRates["5KG"] !== null) {
                    cost = companyRates["5KG"];
                    calculationDetails += `<p>计算价格: ¥${cost} (5KG内一口价)</p>`;
                    calculationDetails += `<p>最终价格: ¥${cost}</p>`;
                } else if (companyRates["5KG"] !== null && companyRates["5上"] !== null) {
                    // 修正：超过5kg的重量全部按5上价格计算
                    cost = weight * companyRates["5上"];
                    calculationDetails += `<p>计算价格: ¥${cost.toFixed(2)} (${weight}kg × ${companyRates["5上"]})</p>`;
                    calculationDetails += `<p>最终价格: ¥${cost.toFixed(2)}</p>`;
                } else {
                    // 只有3KG价格可用的情况
                    cost = companyRates["3KG"];
                    calculationDetails += `<p>计算价格: ¥${cost} (仅3KG内一口价可用)</p>`;
                    calculationDetails += `<p>最终价格: ¥${cost}</p>`;
                }
                break;

            case "百世":
                if (volume <= 0.4) {
                    weight = volume / 0.01;
                    calculationDetails = `<p>计算方式: 体积 / 0.01 (因体积 ≤ 0.4m³)</p>`;
                } else if (volume > 0.4 && volume < 4.99) {
                    weight = volume / 0.008;
                    calculationDetails = `<p>计算方式: 体积 / 0.008 (因体积 > 0.4m³)</p>`;
                } else {
                     return costHtml + "<p>体积超出范围 (≥ 4.99m³)</p>";
                }
                weight = Math.ceil(weight); // 向上取整
                calculationDetails += `<p>抛重: ${weight} kg (向上取整)</p>`;
                cost = weight * companyRates["0.4下/10000"];
                calculationDetails += `<p>计算价格: ¥${cost.toFixed(2)} (${weight}kg × ${companyRates["0.4下/10000"]})</p>`;
                if (cost < companyRates["最低"]) {
                    cost = companyRates["最低"];
                    calculationDetails += `<p>最终价格: ¥${cost} (因计算价低于最低消费 ${companyRates["最低"]})</p>`;
                } else {
                    calculationDetails += `<p>最终价格: ¥${cost.toFixed(2)}</p>`;
                }
                break;

            case "顺心捷达":
                 if (volume < 0.55) {
                    weight = volume / 0.01;
                    calculationDetails = `<p>计算方式: 体积 / 0.01 (因体积 < 0.55m³)</p>`;
                } else {
                    return costHtml + "<p>体积超出范围 (≥ 0.55m³)</p>";
                }
                weight = Math.ceil(weight); // 向上取整
                calculationDetails += `<p>抛重: ${weight} kg (向上取整)</p>`;
                cost = weight * companyRates["0.55/10000"];
                calculationDetails += `<p>计算价格: ¥${cost.toFixed(2)} (${weight}kg × ${companyRates["0.55/10000"]})</p>`;
                if (cost < companyRates["最低"]) {
                    cost = companyRates["最低"];
                    calculationDetails += `<p>最终价格: ¥${cost} (因计算价低于最低消费 ${companyRates["最低"]})</p>`;
                } else {
                    calculationDetails += `<p>最终价格: ¥${cost.toFixed(2)}</p>`;
                }
                break;
        }

        costHtml += `<div style="padding-left: 10px; border-left: 3px solid #eee;">${calculationDetails}</div>`;
        return costHtml;
    }

    function calculateBoxCost(box, pricePerWeight, minWeight = 0) {
        const adjustedVolume = getAdjustedVolume(box);
        const originalWeight = adjustedVolume / 0.006;
        const roundedWeight = Math.ceil(originalWeight);
        const finalWeight = Math.max(roundedWeight, minWeight);
        const shippingCost = finalWeight * pricePerWeight;

        let detailsHtml = `<div style="padding-left: 10px; border-left: 3px solid #eee;">`;
        detailsHtml += `<p style="margin: 2px 0; font-weight: bold;">箱子规格: ${box.size}cm</p>`;
        detailsHtml += `<p style="margin: 2px 0;">调整后尺寸: ${(box.dimensions.l + 3)}*${(box.dimensions.w + 3)}*${(box.dimensions.h + 3)}cm</p>`;
        detailsHtml += `<p style="margin: 2px 0;">调整后体积: ${adjustedVolume.toFixed(6)}m³</p>`;
        detailsHtml += `<p style="margin: 2px 0;">原始重量: ${originalWeight.toFixed(4)}kg (体积 ÷ 0.006)</p>`;
        detailsHtml += `<p style="margin: 2px 0;">取整重量: ${roundedWeight}kg (向上取整)</p>`;
        
        if (minWeight > 0 && roundedWeight < minWeight) {
            detailsHtml += `<p style="margin: 2px 0; color: #ffc107;">最低重量限制: ${minWeight}kg</p>`;
            detailsHtml += `<p style="margin: 2px 0;">计费重量: ${finalWeight}kg (取较大值)</p>`;
        } else {
            detailsHtml += `<p style="margin: 2px 0;">计费重量: ${finalWeight}kg</p>`;
        }
        
        detailsHtml += `<p style="margin: 2px 0; font-weight: bold;">单个运费: ${shippingCost.toFixed(2)} (${finalWeight}kg × ${pricePerWeight})</p>`;
        detailsHtml += `</div>`;

        return { cost: shippingCost, detailsHtml: detailsHtml };
    }

    function updateHistory() {
      const ul = document.getElementById("history");
      const clearBtn = document.getElementById("clearBtn");
      const noHistory = document.getElementById("noHistory");
      
      ul.innerHTML = "";
      
      if (history.length === 0) {
        clearBtn.style.display = "none";
        noHistory.style.display = "block";
        return;
      }
      
      clearBtn.style.display = "block";
      noHistory.style.display = "none";
      
      history.forEach((item, index) => {
        const li = document.createElement("li");
        
        li.innerHTML = `
          <div class="history-item">
            <div>${item.calculation}</div>
            <div class="history-time">${item.time}</div>
          </div>
          <div class="history-actions">
            <button class="history-btn" onclick="reuseCalculation(${index})" title="重新使用这些数据">重用</button>
            <button class="history-btn" onclick="copyToClipboard('${item.calculation}')" title="复制计算结果">复制</button>
            <button class="history-btn" onclick="deleteHistoryItem(${index})" title="删除这条记录" style="color: #dc3545;">删除</button>
          </div>
        `;
        
        ul.appendChild(li);
      });
    }
    
    function clearHistory() {
      if (confirm('确定要清空所有计算历史吗？')) {
        history.length = 0;
        updateHistory();
      }
    }
    
    function deleteHistoryItem(index) {
      if (confirm('确定要删除这条记录吗？')) {
        history.splice(index, 1);
        updateHistory();
      }
    }
    
    function reuseCalculation(index) {
      const item = history[index];
      const data = item.data;
      
      // Reset to a single item view
      const wrapper = document.getElementById('items-wrapper');
      wrapper.innerHTML = '';
      itemCount = 0;
      addItem(); // Add the first item back

      const firstItem = wrapper.querySelector('.item-container');
      
      // 填充输入框
      firstItem.querySelector(".length").value = data.length;
      firstItem.querySelector(".width").value = data.width;
      firstItem.querySelector(".height").value = data.height;
      firstItem.querySelector(".unitQuantity").value = data.unitQuantity;
      firstItem.querySelector(".actualQuantity").value = data.actualQuantity;
      
      // 自动计算
      calculateVolume();
      
      // 滚动到顶部
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // 简单的复制成功提示
        const target = event.target;
        const originalText = target.textContent;
        target.textContent = '已复制';
        target.style.backgroundColor = '#28a745';
        target.style.color = 'white';
        
        setTimeout(() => {
          target.textContent = originalText;
          target.style.backgroundColor = '';
          target.style.color = '';
        }, 1000);
      }).catch((err) => {
        console.error('Async: Could not copy text: ', err);
        // Fallback for older browsers
        try {
          const textArea = document.createElement("textarea");
          textArea.value = text;
          
          // Avoid scrolling to bottom
          textArea.style.top = "0";
          textArea.style.left = "0";
          textArea.style.position = "fixed";

          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          const successful = document.execCommand('copy');
          const target = event.target;
          if(successful) {
            const originalText = target.textContent;
            target.textContent = '已复制';
            target.style.backgroundColor = '#28a745';
            target.style.color = 'white';
            
            setTimeout(() => {
              target.textContent = originalText;
              target.style.backgroundColor = '';
              target.style.color = '';
            }, 1000);
          } else {
            alert('复制失败，请手动复制');
          }
          document.body.removeChild(textArea);
        } catch (err) {
            alert('复制失败，请手动复制');
        }
      });
    }
    
    // 快速推荐功能
    function quickRecommendByVolume() {
      const volume = parseFloat(document.getElementById("quickVolume").value);
      
      if (isNaN(volume) || volume <= 0) {
        document.getElementById("quickResults").style.display = "none";
        alert("请输入有效的体积值");
        return;
      }
      
      displayQuickRecommendation(volume);
    }
    
    function quickRecommendByDimensions() {
      const length = parseFloat(document.getElementById("quickLength").value);
      const width = parseFloat(document.getElementById("quickWidth").value);
      const height = parseFloat(document.getElementById("quickHeight").value);
      
      if (isNaN(length) || isNaN(width) || isNaN(height) || length <= 0 || width <= 0 || height <= 0) {
        document.getElementById("quickResults").style.display = "none";
        alert("请输入有效的长宽高值");
        return;
      }
      
      // 转换为m³
      const volume = (length / 100) * (width / 100) * (height / 100);
      displayQuickRecommendation(volume);
    }
    
    function displayQuickRecommendation(targetVolume) {
      const resultsDiv = document.getElementById("quickResults");
      const contentDiv = document.getElementById("quickResultsContent");
      
      const { closestLarger, closestSmaller } = findClosestBoxes(targetVolume);
      
      let html = `<p><strong>目标体积:</strong> ${targetVolume.toFixed(6)} m³</p>`;
      
      if (closestLarger) {
        html += `<p><strong>推荐 (较大):</strong><br>`;
        html += `${closestLarger.size}cm<br>`;
        html += `体积: ${closestLarger.volume.toFixed(6)}m³</p>`;
      }
      
      if (closestSmaller) {
        html += `<p><strong>推荐 (较小):</strong><br>`;
        html += `${closestSmaller.size}cm<br>`;
        html += `体积: ${closestSmaller.volume.toFixed(6)}m³</p>`;
      }
      
      if (!closestLarger && !closestSmaller) {
        html += `<p style="color: #dc3545;">未找到合适的箱子</p>`;
      }
      
      contentDiv.innerHTML = html;
      resultsDiv.style.display = "block";
    }
  </script>
</body>
</html>
