<!DOCTYPE html>
<html>
<head>
  <title>简单计算器</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 600px;
      padding: 30px;
      text-align: center;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .input-group {
      margin: 15px 0;
      text-align: left;
    }
    
    .input-row {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .input-item {
      flex: 1;
      min-width: 150px;
    }
    
    .input-group label,
    .input-item label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
      font-size: 14px;
    }
    
    .input-group input,
    .input-item input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
    }
    
    #input {
      width: 300px;
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
    
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    button:hover {
      background-color: #0056b3;
    }
    
    #result {
      font-weight: bold;
      color: #007bff;
      font-size: 18px;
    }
    
    #boxSuggestions {
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #007bff;
    }
    
    #boxSuggestions h3 {
      margin-top: 0;
      color: #007bff;
    }
    
    #boxSuggestions p {
      margin: 10px 0;
    }
    
    #shippingSection {
      margin: 20px 0;
      padding: 15px;
      background-color: #e8f4f8;
      border-radius: 5px;
      border-left: 4px solid #17a2b8;
    }
    
    #shippingResults {
      margin-top: 15px;
      padding: 10px;
      background-color: #d4edda;
      border-radius: 5px;
      border-left: 4px solid #28a745;
    }
    
    #shippingResults h4 {
      margin-top: 0;
      color: #28a745;
    }
    
    #history {
      text-align: left;
      max-width: 500px;
      margin: 0 auto;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #fafafa;
    }
    
    #history li {
      padding: 10px;
      border-bottom: 1px solid #eee;
      position: relative;
      transition: background-color 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #history li:hover {
      background-color: #f0f8ff;
    }
    
    #history li:last-child {
      border-bottom: none;
    }
    
    .history-item {
      flex: 1;
      font-size: 14px;
    }
    
    .history-time {
      font-size: 12px;
      color: #666;
      margin-left: 10px;
    }
    
    .history-actions {
      display: flex;
      gap: 5px;
    }
    
    .history-btn {
      padding: 2px 6px;
      font-size: 12px;
      border: 1px solid #ccc;
      background-color: white;
      border-radius: 3px;
      cursor: pointer;
      color: #666;
    }
    
    .history-btn:hover {
      background-color: #e9ecef;
    }
    
    .clear-history-btn {
      margin-bottom: 10px;
      padding: 8px 15px;
      font-size: 14px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .clear-history-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>体积计算器</h1>
    <div style="text-align: center; margin: 20px 0;">
      <img src="../assets/images/shu.gif" alt="装饰图片" style="max-width: 150px; height: auto; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    </div>
    <div class="input-row">
      <div class="input-item">
        <label>长度 (cm):</label>
        <input type="number" id="length" placeholder="输入长度" step="0.01">
      </div>
      <div class="input-item">
        <label>宽度 (cm):</label>
        <input type="number" id="width" placeholder="输入宽度" step="0.01">
      </div>
      <div class="input-item">
        <label>高度 (cm):</label>
        <input type="number" id="height" placeholder="输入高度" step="0.01">
      </div>
      <div class="input-item">
        <label>单位体积货物数量:</label>
        <input type="number" id="unitQuantity" placeholder="输入单位体积货物数量" step="1">
      </div>
      <div class="input-item">
        <label>实际货物数量:</label>
        <input type="number" id="actualQuantity" placeholder="输入实际货物数量" step="1">
      </div>
    </div>
    <button onclick="calculateVolume()">计算实际体积</button>
    <p>实际体积：<span id="result"></span> m³</p>
    <div id="boxSuggestions"></div>
    
    <div id="shippingSection" style="display: none;">
      <div class="input-group">
        <label>每重量单价:</label>
        <input type="number" id="pricePerWeight" placeholder="输入每重量单价" step="0.01">
        <button onclick="calculateShipping()" style="margin-left: 10px;">计算国际运费</button>
      </div>
      <div id="shippingResults"></div>
    </div>

    <h2>计算历史</h2>
    <div id="historyContainer">
      <button class="clear-history-btn" onclick="clearHistory()" style="display: none;" id="clearBtn">清空历史</button>
      <ul id="history"></ul>
      <p id="noHistory" style="text-align: center; color: #666; font-style: italic;">暂无计算历史</p>
    </div>
  </div>

  <script>
    const history = [];
    let currentSuitableBoxes = []; // 存储当前推荐的箱子
    
    // 箱子数据 (长*宽*高，单位：cm)
    const boxes = [
      {size: "18*10*12", volume: 0.002160, dimensions: {l: 18, w: 10, h: 12}},
      {size: "19.5*10.5*13.5", volume: 0.002766, dimensions: {l: 19.5, w: 10.5, h: 13.5}},
      {size: "21*11*14", volume: 0.003234, dimensions: {l: 21, w: 11, h: 14}},
      {size: "23*13*8", volume: 0.002392, dimensions: {l: 23, w: 13, h: 8}},
      {size: "23*13*26", volume: 0.007774, dimensions: {l: 23, w: 13, h: 26}},
      {size: "26*15*9", volume: 0.003510, dimensions: {l: 26, w: 15, h: 9}},
      {size: "26*15*18", volume: 0.007020, dimensions: {l: 26, w: 15, h: 18}},
      {size: "29*17*19", volume: 0.009367, dimensions: {l: 29, w: 17, h: 19}},
      {size: "29*37*52", volume: 0.055796, dimensions: {l: 29, w: 37, h: 52}},
      {size: "30*21.5*5", volume: 0.003225, dimensions: {l: 30, w: 21.5, h: 5}},
      {size: "35*19*23", volume: 0.015295, dimensions: {l: 35, w: 19, h: 23}},
      {size: "37*37*47", volume: 0.064343, dimensions: {l: 37, w: 37, h: 47}},
      {size: "43*21*28", volume: 0.025284, dimensions: {l: 43, w: 21, h: 28}},
      {size: "47*36*41", volume: 0.069372, dimensions: {l: 47, w: 36, h: 41}},
      {size: "47*37*43", volume: 0.074761, dimensions: {l: 47, w: 37, h: 43}},
      {size: "49*27*27", volume: 0.035721, dimensions: {l: 49, w: 27, h: 27}},
      {size: "49*27*33", volume: 0.043659, dimensions: {l: 49, w: 27, h: 33}},
      {size: "50*50*50", volume: 0.125000, dimensions: {l: 50, w: 50, h: 50}},
      {size: "57*40*35", volume: 0.079800, dimensions: {l: 57, w: 40, h: 35}},
      {size: "60*40*30", volume: 0.072000, dimensions: {l: 60, w: 40, h: 30}},
      {size: "60*40*40", volume: 0.096000, dimensions: {l: 60, w: 40, h: 40}},
      {size: "70*50*50", volume: 0.175000, dimensions: {l: 70, w: 50, h: 50}},
      {size: "85*50*50", volume: 0.212500, dimensions: {l: 85, w: 50, h: 50}},
      {size: "90*30*30", volume: 0.081000, dimensions: {l: 90, w: 30, h: 30}},
      {size: "100*16*16", volume: 0.025600, dimensions: {l: 100, w: 16, h: 16}},
      {size: "100*50*50", volume: 0.250000, dimensions: {l: 100, w: 50, h: 50}},
      {size: "130*30*20", volume: 0.078000, dimensions: {l: 130, w: 30, h: 20}},
      {size: "130*40*60", volume: 0.312000, dimensions: {l: 130, w: 40, h: 60}},
      {size: "130*50*20", volume: 0.130000, dimensions: {l: 130, w: 50, h: 20}},
      {size: "130*50*50", volume: 0.325000, dimensions: {l: 130, w: 50, h: 50}},
      {size: "130*50*60", volume: 0.390000, dimensions: {l: 130, w: 50, h: 60}},
      {size: "130*50*80", volume: 0.520000, dimensions: {l: 130, w: 50, h: 80}},
      {size: "130*60*80", volume: 0.624000, dimensions: {l: 130, w: 60, h: 80}},
      {size: "140*60*16", volume: 0.134400, dimensions: {l: 140, w: 60, h: 16}}
    ];
    
    // 按体积排序
    boxes.sort((a, b) => a.volume - b.volume);

    function calculateVolume() {
      // 获取输入值
      const length = parseFloat(document.getElementById("length").value);
      const width = parseFloat(document.getElementById("width").value);
      const height = parseFloat(document.getElementById("height").value);
      const unitQuantity = parseFloat(document.getElementById("unitQuantity").value);
      const actualQuantity = parseFloat(document.getElementById("actualQuantity").value);
      
      // 验证输入
      if (isNaN(length) || isNaN(width) || isNaN(height) || isNaN(unitQuantity) || isNaN(actualQuantity)) {
        document.getElementById("result").textContent = "请输入有效的数值";
        return;
      }
      
      if (unitQuantity <= 0) {
        document.getElementById("result").textContent = "单位体积货物数量必须大于0";
        return;
      }
      
      // 将cm转换为m进行计算
      const lengthInM = length / 100;
      const widthInM = width / 100;
      const heightInM = height / 100;
      
      // 计算实际体积：长*宽*高/单位体积货物数量 * 实际货物数量
      const actualVolume = (lengthInM * widthInM * heightInM / unitQuantity) * actualQuantity;
      
      // 显示结果，保留7位小数
      const result = actualVolume.toFixed(7);
      document.getElementById("result").textContent = result;
      
      // 查找合适的箱子
      findSuitableBoxes(actualVolume);
      
      // 添加到历史记录
      const timestamp = new Date().toLocaleString('zh-CN');
      const historyItem = {
        calculation: `长${length}cm × 宽${width}cm × 高${height}cm ÷ ${unitQuantity} × ${actualQuantity} = ${result} m³`,
        time: timestamp,
        data: {
          length, width, height, unitQuantity, actualQuantity, result
        }
      };
      history.unshift(historyItem); // 最新的记录放在前面
      
      // 限制历史记录数量为20条
      if (history.length > 20) {
        history.splice(20);
      }
      
      updateHistory();
    }
    
    function findSuitableBoxes(targetVolume) {
      const suggestionsDiv = document.getElementById("boxSuggestions");
      const shippingSection = document.getElementById("shippingSection");
      
      // 找到最接近的更大的箱子
      const largerBoxes = boxes.filter(box => box.volume > targetVolume);
      const closestLarger = largerBoxes.length > 0 ? largerBoxes[0] : null;
      
      // 找到最接近的更小的箱子
      const smallerBoxes = boxes.filter(box => box.volume <= targetVolume);
      const closestSmaller = smallerBoxes.length > 0 ? smallerBoxes[smallerBoxes.length - 1] : null;
      
      // 组合推荐箱子
      const suitableBoxes = [];
      if (closestLarger) suitableBoxes.push(closestLarger);
      if (closestSmaller) suitableBoxes.push(closestSmaller);
      
      if (suitableBoxes.length === 0) {
        suggestionsDiv.innerHTML = "<p style='color: red;'>没有找到合适的箱子</p>";
        shippingSection.style.display = "none";
        return;
      }
      
      // 保存当前推荐的箱子用于运费计算
      currentSuitableBoxes = suitableBoxes;
      
      let html = "<h3>推荐箱子:</h3>";
      
      suitableBoxes.forEach((box, index) => {
        const comparison = box.volume > targetVolume ? "比目标体积大" : "比目标体积小";
        const diff = Math.abs(box.volume - targetVolume).toFixed(7);
        html += `<p><strong>推荐${index + 1}:</strong> ${box.size} cm (体积: ${box.volume.toFixed(7)} m³, ${comparison}, 差值: ${diff} m³)</p>`;
      });
      
      suggestionsDiv.innerHTML = html;
      
      // 显示运费计算区域
      shippingSection.style.display = "block";
      // 清空之前的运费结果
      document.getElementById("shippingResults").innerHTML = "";
    }
    
    function calculateShipping() {
      const pricePerWeight = parseFloat(document.getElementById("pricePerWeight").value);
      
      if (isNaN(pricePerWeight) || pricePerWeight <= 0) {
        document.getElementById("shippingResults").innerHTML = "<p style='color: red;'>请输入有效的每重量单价</p>";
        return;
      }
      
      let html = "<h4>国际运费计算结果:</h4>";
      
      currentSuitableBoxes.forEach((box, index) => {
        // 加3cm后的尺寸
        const adjustedLength = (box.dimensions.l + 3) / 100; // 转换为米
        const adjustedWidth = (box.dimensions.w + 3) / 100;  // 转换为米
        const adjustedHeight = (box.dimensions.h + 3) / 100; // 转换为米
        
        // 计算调整后的体积
        const adjustedVolume = adjustedLength * adjustedWidth * adjustedHeight;
        
        // 除以0.008计算重量
        const weight = adjustedVolume / 0.006;
        
        // 计算运费
        const shippingCost = weight * pricePerWeight;
        
        const orderText = `推荐${index + 1}`;
        
        html += `<div style="margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px;">
          <p><strong>${orderText}箱子:</strong> ${box.size} cm</p>
          <p><strong>调整后尺寸:</strong> ${(box.dimensions.l + 3)}*${(box.dimensions.w + 3)}*${(box.dimensions.h + 3)} cm</p>
          <p><strong>调整后体积:</strong> ${adjustedVolume.toFixed(7)} m³</p>
          <p><strong>计算重量:</strong> ${weight.toFixed(7)} (体积÷0.006)</p>
          <p><strong>国际运费:</strong> ${shippingCost.toFixed(2)} (重量×单价)</p>
        </div>`;
      });
      
      document.getElementById("shippingResults").innerHTML = html;
    }

    function updateHistory() {
      const ul = document.getElementById("history");
      const clearBtn = document.getElementById("clearBtn");
      const noHistory = document.getElementById("noHistory");
      
      ul.innerHTML = "";
      
      if (history.length === 0) {
        clearBtn.style.display = "none";
        noHistory.style.display = "block";
        return;
      }
      
      clearBtn.style.display = "block";
      noHistory.style.display = "none";
      
      history.forEach((item, index) => {
        const li = document.createElement("li");
        
        li.innerHTML = `
          <div class="history-item">
            <div>${item.calculation}</div>
            <div class="history-time">${item.time}</div>
          </div>
          <div class="history-actions">
            <button class="history-btn" onclick="reuseCalculation(${index})" title="重新使用这些数据">重用</button>
            <button class="history-btn" onclick="copyToClipboard('${item.calculation}')" title="复制计算结果">复制</button>
            <button class="history-btn" onclick="deleteHistoryItem(${index})" title="删除这条记录" style="color: #dc3545;">删除</button>
          </div>
        `;
        
        ul.appendChild(li);
      });
    }
    
    function clearHistory() {
      if (confirm('确定要清空所有计算历史吗？')) {
        history.length = 0;
        updateHistory();
      }
    }
    
    function deleteHistoryItem(index) {
      if (confirm('确定要删除这条记录吗？')) {
        history.splice(index, 1);
        updateHistory();
      }
    }
    
    function reuseCalculation(index) {
      const item = history[index];
      const data = item.data;
      
      // 填充输入框
      document.getElementById("length").value = data.length;
      document.getElementById("width").value = data.width;
      document.getElementById("height").value = data.height;
      document.getElementById("unitQuantity").value = data.unitQuantity;
      document.getElementById("actualQuantity").value = data.actualQuantity;
      
      // 自动计算
      calculateVolume();
      
      // 滚动到顶部
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // 简单的复制成功提示
        const originalText = event.target.textContent;
        event.target.textContent = '已复制';
        event.target.style.backgroundColor = '#28a745';
        event.target.style.color = 'white';
        
        setTimeout(() => {
          event.target.textContent = originalText;
          event.target.style.backgroundColor = '';
          event.target.style.color = '';
        }, 1000);
      }).catch(() => {
        alert('复制失败，请手动复制');
      });
    }
  </script>
</body>
</html>
